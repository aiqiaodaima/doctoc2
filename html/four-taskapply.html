<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>科研课题资助申请</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0,viewport-fit=cover">
    <!-- 引入样式 -->
    <link rel="stylesheet" href="https://cdn.bootcss.com/weui/1.1.2/style/weui.min.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/jquery-weui/1.2.0/css/jquery-weui.min.css">
    <!-- <link rel="stylesheet" href="../css/index.css"> -->
    <!-- <link rel="stylesheet" href="../css/ydui.css"> -->
    <!-- 通用样式 -->
    <link rel="stylesheet" href="../css/four-taskapply.css">
    <link rel="stylesheet" href="../css/public.css">
</head>

<body ontouchstart>
    <div class="page__bd" style="height: 100%;">
        <div class="weui-cells weui-cells_form">
        	<form id="formdata1">
        		<div class="weui-cell weui-cell_select weui-cell_select-after">
	                <div class="weui-cell__hd">
	                    <label for="" class="weui-label">分类</label>
	                </div>
	                <div class="weui-cell__bd">
	                    <select class="weui-select select1" name="taskType">
	                        <option value="">请选择</option>
	                        <option value="新增">新增</option>
	                        <option value="既存">既存</option>
	                        <option value="博士后">博士后</option>
	                    </select>
	                </div>
	            </div>
	            <div class="weui-cell">
	                <div class="weui-cell__hd">
	                    <label class="weui-label">课题名称</label>
	                </div>
	                <div class="weui-cell__bd">
	                    <input class="weui-input" type="text" name="taskName" placeholder="请输入课题名称">
	                </div>
	            </div>
	            <div class="weui-cell weui-cell_select weui-cell_select-after">
	                <div class="weui-cell__hd">
	                    <label for="select2" class="weui-label label_change">拟申报</label>
	                </div>
	                <div class="weui-cell__bd">
	                    <select class="weui-select selector_12" name="declare">
	                        <option value="">请选择</option>
	                        <option value="国家自然科学基金">国家自然科学基金</option>
	                        <option value="国家卫生计生委">国家卫生计生委</option>
	                        <option value="国家发改委">国家发改委</option>
	                        <option value="国务院相关部委">国务院相关部委</option>
	                        <option value="国务院相关机构">国务院相关机构</option>
	                        <option value="省科技厅">省科技厅</option>
	                        <option value="省卫生计生委">省卫生计生委</option>
	                        <option value="省发改委">省发改委</option>
	                        <option value="市辖主管">市辖主管</option>
	                        <option value="市相关部委">市相关部委</option>
	                        <option value="市相关结构">市相关结构</option>
	                        <option value="本院">本院</option>
	                        <option value="校相关机构">校相关机构</option>
	                    </select>
	                </div>
	            </div>
	        </form>
        	<form id="formdata2">
	            <div class="weui-cell selector_add" style="display: none;">
	                <div class="weui-cell__hd">
	                    <label class="weui-label">部委/机构名</label>
	                </div>
	                <div class="weui-cell__bd">
	                    <input class="weui-input" type="text" name="tissue" placeholder="请输入部委/机构名">
	                </div>
	            </div>
	        </form>
        	<form id="formdata3">
	            <div class="weui-cell weui-cell_select weui-cell_select-after">
	                <div class="weui-cell__hd">
	                    <label for="select2" class="weui-label">级别</label>
	                </div>
	                <div class="weui-cell__bd">
	                    <select class="weui-select" name="rank">
	                        <option value="">请选择</option>
	                        <option value="国家级">国家级</option>
	                        <option value="省级">省级</option>
	                        <option value="市级">市级</option>
	                        <option value="院校级">院校级</option>
	                    </select>
	                </div>
	            </div>
	            <div class="weui-cell weui-cell_select weui-cell_select-after">
	                <div class="weui-cell__hd">
	                    <label for="select4" class="weui-label">性质</label>
	                </div>
	                <div class="weui-cell__bd">
	                    <select class="weui-select" name="nature">
	                        <option value="">请选择</option>
	                        <option value="重大">重大</option>
	                        <option value="攻关">攻关</option>
	                        <option value="应用">应用</option>
	                        <option value="协作">协作</option>
	                        <option value="验证">验证</option>
	                        <option value="预实验">预实验</option>
	
	                    </select>
	                </div>
	            </div>
	            <div class="weui-cell weui-cell_select weui-cell_select-after">
	                <div class="weui-cell__hd">
	                    <label for="select5" class="weui-label">研究水平</label>
	                </div>
	                <div class="weui-cell__bd">
	                    <select class="weui-select" name="standard">
	                        <option value="">请选择</option>
	                        <option value="细胞水平">细胞水平</option>
	                        <option value="分子水平/基因水平">分子水平/基因水平</option>
	                        <option value="其他">其他</option>
	                    </select>
	                </div>
	            </div>
	            <div class="weui-cell">
	                <div class="weui-cell__hd">
	                    <label class="weui-label">预算金额</label>
	                </div>
	                <div class="weui-cell__bd">
	                    <input class="weui-input" type="number" pattern="[0-9]*" name="budgetMoney" placeholder="请输入预算金额">
	                </div>
	            </div>
	            <div class="weui-cell">
	                <div class="weui-cell__hd">
	                    <label class="weui-label">已获得资助金额</label>
	                </div>
	                <div class="weui-cell__bd">
	                    <input class="weui-input" type="number" pattern="[0-9]*" name="gainMoney" placeholder="请输入已获得资助金额">
	                </div>
	            </div>
	            <div class="weui-cell">
	                <div class="weui-cell__hd">
	                    <label class="weui-label">本次申请资助金额</label>
	                </div>
	                <div class="weui-cell__bd">
	                    <input class="weui-input" type="number" pattern="[0-9]*" name="applicatMoney" placeholder="请输入本次申请资助金额">
	                </div>
	            </div>
	            <div class="weui-cell">
	                <div class="weui-cell__hd">
	                    <label class="weui-label">资金用途说明</label>
	                </div>
	                <div class="weui-cell__bd">
	                    <input class="weui-input" type="text" name="capital" placeholder="请输入资金用途说明">
	                </div>
	            </div>
	        </form>
        	<form id="formdata4">
	            <div class="weui-cell weui-cell_switch selector_1 ">
	                <div class="weui-cell__hd">
	                    <label class="weui-label">博士后流动站</label>
	                </div>
	                <div class="weui-cell__ft">
	                    <label for="switchCP" class="weui-switch-cp">
	                        <input id="switchCP" class="weui-switch-cp__input" type="checkbox" checked="checked">
	                        <div class="weui-switch-cp__box"></div>
	                    </label>
	                </div>
	            </div>
	            <div class="weui-cell selector_1 moving">
	                <div class="weui-cell__hd">
	                    <label class="weui-label">流动站名称</label>
	                </div>
	                <div class="weui-cell__bd">
	                    <input class="weui-input" type="text" name="bachelors" placeholder="请输入流动站名称" style="text-align:right">
	                </div>
	            </div>
	            <div class="weui-cell selector_1 moving">
	                <div class="weui-cell__hd">
	                    <label class="weui-label">入站时间</label>
	                </div>
	                <div class="weui-cell__bd">
	                    <input class="weui-input" type="text" id='datetime-picker' name="bhlStartTime" placeholder="请选择" />
	                </div>
	            </div>
	            <div class="weui-cell selector_1 moving">
	                <div class="weui-cell__hd">
	                    <label class="weui-label">出站时间</label>
	                </div>
	                <div class="weui-cell__bd">
	                    <input class="weui-input" type="text" id='datetime-picker2' name="bhlEndTime" placeholder="请选择" />
	                </div>
	            </div>
	        </form>
        	<form id="formdata5">
	            <div class="weui-cell">
	                <div class="weui-cell__hd">
	                    <label class="weui-label">开题时间</label>
	                </div>
	                <div class="weui-cell__bd">
	                    <input class="weui-input" type="text" id='datetime-picker3' name="tkStartTime" placeholder="请选择" />
	                </div>
	            </div>
	            <div class="weui-cell">
	                <div class="weui-cell__hd">
	                    <label class="weui-label">结题时间</label>
	                </div>
	                <div class="weui-cell__bd">
	                    <input class="weui-input" type="text" id='datetime-picker4' name="tkEndTime" placeholder="请选择" />
	                </div>
	            </div>
        	</form>
        </div>
        <div class="btn_top"></div>
        <div class="item_btn">
            <a id="updata">提交资助申请</a>
        </div>
    </div>
</body>
<script src="https://cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/jquery-weui/1.2.0/js/jquery-weui.min.js"></script>
<script src="../js/public.js" type="text/javascript" charset="utf-8"></script>
<script>
    $(function () {
        $("#datetime-picker").datetimePicker({
            times: function () {
                return [
                ];
            },
            onChange: function (picker, values, displayValues) {
                console.log(values);
            }
        });
        $("#datetime-picker2").datetimePicker({
            times: function () {
                return [
                ];
            },
            onChange: function (picker, values, displayValues) {
                console.log(values);
            }
        });
        $("#datetime-picker3").datetimePicker({
            times: function () {
                return [
                ];
            },
            onChange: function (picker, values, displayValues) {
                console.log(values);
            }
        });
        $("#datetime-picker4").datetimePicker({
            times: function () {
                return [
                ];
            },
            onChange: function (picker, values, displayValues) {
                console.log(values);
            }
        });
        var verifyform = ["#formdata1","#formdata3","#formdata4","#formdata5"];
        $('.select1').on('change', function () {
            if ($('.select1').val() == "新增") {
                $('.label_change').text('拟申报');
                $('.selector_1').slideUp("slow");
                verifyform = verifyform.join(",").replace(/,#formdata4/g,"").split(",");
            } else if ($('.select1').val() == "既存") {
                $('.label_change').text('已申报');
                $('.selector_1').slideUp("slow");
                verifyform = verifyform.join(",").replace(/,#formdata4/g,"").split(",");
            } else if ($('.select1').val() == "博士后") {
                $('.selector_1').slideDown("slow");
                $('.label_change').text('已(拟)申报');
                verifyform.push("#formdata4");
            }
        })
        $('.selector_12').on('change', function () {
        	var reg = /国家发改委|国务院相关部委|省发改委|市辖主管|市相关部委|市相关结构|本院/g
        	if ($('.selector_12').val().search(reg) != -1) {
                $('.selector_add').slideDown('fast');
                verifyform.push("#formdata2");
        	} else{
                $('.selector_add').slideUp('fast');
                verifyform = verifyform.join(",").replace(/,#formdata2/g,"").split(",");
        	}
        })
        $('.weui-switch-cp__input').on('change', function () {
            $('.moving').fadeToggle(800);
        })
        // console.log($('.select1').val())
        $('.weui-select').on('change', function () {
           $(this).css('color','#666');
        })
        let url = Public.url();
        $("#updata").click(function () {
        	var returnVal = false;
        	$(verifyform.join(",")).find("[name]").each(function () {
        		var $this = this,
        			inputval = $(this).val().trim();
        			itemval = $(this).closest(".weui-cell").find("label").text();
        		if (inputval=="") {
        			$.alert(itemval+"不能为空")
        			returnVal = true;
        			return false;
        		}
        	});
        	if (returnVal) {
        		return false;
        	}
        	$.ajax({
	        	url : `${url}/task/insertOrUpdateDt`,
	        	type: 'post',
	        	data: $(verifyform.join(",")).serialize() + '&dtrId=' + localStorage.userId,
	        	success(data) {
	        		console.log(data);
	        		if (data.msg == "操作成功") {
	        			$.alert(data.msg,()=>{
	        				window.location.href = "audit.html";
	        			});
	        		} else {
	        			$.alert(data.msg);
	        		}
	        	}
	        })
        })
	        
    });
</script>

</html>