<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>会议详情</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0,viewport-fit=cover">
    <!-- 引入样式 -->
    <link rel="stylesheet" href="https://cdn.bootcss.com/weui/1.1.2/style/weui.min.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/jquery-weui/1.2.0/css/jquery-weui.min.css">
    <!-- <link rel="stylesheet" href="../css/index.css"> -->
    <link rel="stylesheet" href="../css/ydui.css">
    <!-- 通用样式 -->
    <link rel="stylesheet" href="../css/public.css">
    <link rel="stylesheet" href="../css/conference-item.css">
</head>
<script src="https://cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/jquery-weui/1.2.0/js/jquery-weui.min.js"></script>
<script src="../js/ydui.js"></script>
<script src="../js/public.js"></script>
<script>
    $(function () {
        if ($('body').width() < 375) {
            for (var i = 0; i < $('.title_work').length; i++) {
                if ($('.title_work').eq(i).text().length > 13) {
                    $('.title_work').eq(i).addClass('disnone');
                    // $(this).addClass('disnone');
                }
            }
            // console.log($('.title_work:last'))
            // $('.title_work:last').eq(0).addClass('disnone');
        };
        $('#J_Slider').slider({
            speed: 1000,
            autoplay: 3000,
            lazyLoad: true
        });
        let url = Public.url();
        let id = window.location.search.split('?')[window.location.search.split('?').length - 1].substr(3);
        $.ajax({
            url: `${url}/metting/selectAllMetting`,
            type: 'POST',
            data: {
                meId: id
            },
            success(res) {
                console.log(res);
                if (res.msg == "数据为空") {
                    alert('该会议数据已被删除')
                }
                let el1 = ` <div class="body_bg">
                    <div class="item_header">
                        ${res.dm.metName}
                    </div>
                    <div class="item_title">
                        <ul>
                            <li class="title_one">
                                <span style="font-weight: 600; color: #333333;">主办方：</span>
                                <img src="" alt="">
                                <span>医生集团</span>
                            </li>
                            <li class="title_two">
                                <div class="width_6">
                                    <img src="../image/ico_clock.svg" alt="" class="img_time">
                                    <span class="word_time">${res.dm.startTime}-${res.dm.endTime}</span>
                                </div>
                                <div class="width_4">
                                    <img src="../image/ico_star.svg" alt="" class="img_star">
                                    <span class="word_star">${res.dm.site}</span>
                                </div>
                            </li>
                            <li class="title_three">
                                <div class="width_6">
                                    <img src="../image/ico_ pos.svg" alt="" class="img_pos">
                                    <span class="word_pos">${res.dm.city}</span>
                                </div>
                                <div class="width_4">
                                    <img src="../image/ico_people.svg" alt="" class="img_people">
                                    <span class="word_people">${res.dm.examine}</span>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>`;
                let el2 = ` <div class="item_carousel">
            <div class="m-slider" id="J_Slider">
                <div class="slider-wrapper">
                    <div class="slider-item">
                        <a href="#">
                            <img src="../image/banner.png" alt="">
                        </a>
                    </div>
                    <div class="slider-item">
                        <a href="#">
                            <img src="../image/banner2.png" alt="">
                        </a>
                    </div>
                    <div class="slider-item">
                        <a href="#">
                            <img src="../image/banner3.png" alt="">
                        </a>
                    </div>
                </div>
                <div class="slider-pagination"></div>
                <!-- 分页标识 -->
            </div>
        </div>`
                if (res.dmct !== null) {
                    var el3 = `
                <div class="item_content">
                <div class="content_title">会议简介</div>
                <div class="content_word">
                    ${res.dmct.content}
                </div>
            </div>
            `
                } else {
                    var el3 = `
                <div class="item_content">
                <div class="content_title">会议简介</div>
                <div class="content_word">
                   您尚未上传会议简介
                </div>
            </div>
            `
                }
                let el4 = ` <div class="item_patient">
            <div class="patient_title">特邀嘉宾</div>
            <div class="patient_photo">
                <ul class="el4">                   
                    
                </ul>
                <div class="photo_more">
                    <a href="javascript:void(0)">查看全部</a>
                    <div class="more_img">
                        <img src="../image/icon-up.png" alt="">
                    </div>
                </div>
            </div>
        </div>`
                if (res.dmct !== null) {
                    var el5 = ` <div class="meeting_item">
            <div class="meeting_title">会议内容及交流形式</div>
            <div class="meeting_word">
                ${res.dmct.content}
            </div>
        </div>`
                } else {
                    var el5 = ` <div class="meeting_item">
            <div class="meeting_title">会议内容及交流形式</div>
            <div class="meeting_word">
                您尚未上传会议内容及交流形式
            </div>
        </div>`
                }

                let el6 = `<div class="meeting_item">
            <div class="meeting_title">组织机构</div>
            <div class="meeting_word el6">
            </div>
        </div>`
                if (res.dmcwList.length == 0) {
                    var el7 = `<div class="meeting_item">
            <div class="meeting_title">联系方式</div>
            <div class="meeting_word">
               
            </div>
        </div>`
                } else {
                    var el7 = `<div class="meeting_item">
            <div class="meeting_title">联系方式</div>
            <div class="meeting_word">
                <span>联系人：${res.dmcwList[0].name}</span>
                <span>电话：${res.dmcwList[0].phone}</span>
                <span>地址：${res.dmcwList[0].hospital}</span>
            </div>
        </div>`
                }
                let el8 = `<div class="btn_top"></div>
        <div class="item_btn">
            <a href="javascript:void(0)" id='show-confirm'>
                申请参会
            </a>
        </div>`
                $('.page__bd').append(el1).append(el2).append(el3).append(el4).append(el5).append(el6).append(el7).append(el8);
                for (let i = 0; i < res.dmtList.length; i++) {
                    if (res.dmtList[i].unit.length > 18) {
                        res.dmtList[i].unit = res.dmtList[i].unit.substring(0, 18) + '...'
                    }
                    let spans = `<span>${res.dmtList[i].type}：${res.dmtList[i].unit}</span>`
                    $('.el6').append(spans)
                }
                for (let i = 0; i < res.dmiList.length; i++) {
                    let lis = `<li class="photo_item">
                        <a href="guest.html">
                            <div class="item_left">
                                <img src= 'https://imuts.oss-cn-shenzhen.aliyuncs.com/${res.dmiList[i].photo}' alt="">
                            </div>
                            <div class="item_right ell4">
                                <div class="right_title">
                                    <span class="title_name">${res.dmiList[i].name}</span>
                                    <span class="title_work">${res.dmiList[i].job}</span>
                                </div>
                                
                            </div>
                        </a>
                    </li>`

                    var arr = res.dmiList[i].actor.split(',');
                    // console.log(arr)
                    for (var j = 0; j < arr.length; j++) {
                        let divs = `<div class="title_work">${arr[j]}</div>`;
                        setTimeout(function () {
                            $('.ell4').eq(i).append(divs);
                            // if()
                        }, 10)

                    }

                    $('.el4').append(lis)
                }
                if (res.dm.applyState !== '允许') {
                    $('#show-confirm').css({ 'background-color': "#333" }).attr('disabled', true);
                }
                $('.patient_photo>ul>li').on('click', function () {
                    window.location.href = 'guest.html'
                });
                $(document).on("click", "#show-confirm", function () {
                    console.log(localStorage.getItem('userId'))
                    if(localStorage.getItem('userId')){
                        console.log(1)
                        if (res.dm.applyState == '允许') {
                            $.confirm("确定提交参会申请", "提示", function () {
                                //   $.toast("文件已经删除!");
                                $.ajax({
                                    url: `${url}/metting/insertDmp`,
                                    type: 'POST',
                                    data :{
                                        meId:id,
                                        dtrId:localStorage.getItem('userId')
                                    },
                                    success (res){
                                        if(res.msg == "操作成功"){
                                            window.location.href = 'refuse1.html'   
                                        }else{
                                            $.alert('参会失败，请联系管理员')
                                        }
                                    },
                                    error (res){
                                        $.alert('系统异常')
                                    }
                                })
                                
                            }, function () {
                                //取消操作
                            });
                        } else {
                            $.alert('该会议不允许自主参会')
                        }
                    }else{
                        $.confirm("请您先登陆再申请参会", "提示", function () {
                                //   $.toast("文件已经删除!");
                            window.location.href = 'index_login.html'
                        }, function () {
                            //取消操作
                        });
                        
                    }
                });
            },
            error(res) {

            }
        })
    });
</script>

<body ontouchstart>
    <div class="page__bd" style="height: 100%;">

    </div>
</body>

</html>