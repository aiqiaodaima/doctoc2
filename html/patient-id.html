<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>医师身份认证</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0,viewport-fit=cover">
    <!-- 引入样式 -->
    <link rel="stylesheet" href="https://cdn.bootcss.com/weui/1.1.2/style/weui.min.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/jquery-weui/1.2.0/css/jquery-weui.min.css">
    <!-- <link rel="stylesheet" href="../css/index.css"> -->
    <!-- <link rel="stylesheet" href="../css/ydui.css"> -->
    <!-- 通用样式 -->
    <link rel="stylesheet" href="../css/public.css">
    <style>
        .weui-popup__modal{
            background: #fff;
        }
        img{
            display: block;
            width: 100%;
        }
        .clause_button{
            width:100%;
            height:3.06rem;
            background:rgba(255,255,255,1);
            display: flex;
        }
        .clause_button a{
            display: block;
            width: 50%;
            text-align: center;
            line-height: 3.06rem;
            font-size:1rem;
            font-family:PingFangSC-Medium;
            color:rgba(102,102,102,1);
            border-top: 1px solid #eaeaea;
        }
        .clause_button a:nth-of-type(1){
            border-right: 1px solid #eaeaea;
        }
    </style>
</head>

<body ontouchstart>
    <div class="page__bd" style="height: 100%;">
        <div class="weui-cells__title">以下每一项均为必填</div>
        <div class="weui-cells weui-cells_form">
            <div class="weui-cell">
                <div class="weui-cell__hd">
                    <label class="weui-label">姓名</label>
                </div>
                <div class="weui-cell__bd">
                    <input class="weui-input input_name" type="text" placeholder="请输入姓名">
                </div>
            </div>
            <div class="weui-cell weui-cell_select weui-cell_select-after">
                <div class="weui-cell__hd">
                    <label for="" class="weui-label">性别</label>
                </div>
                <div class="weui-cell__bd">
                    <select class="weui-select input_sex" name="select2">
                        <option value="0">请选择</option>
                        <option value="男">男</option>
                        <option value="女">女</option>
                    </select>
                </div>
            </div>

            <div class="weui-cell">
                <div class="weui-cell__hd">
                    <label class="weui-label">年龄</label>
                </div>
                <div class="weui-cell__bd">
                    <input class="weui-input input_age" type="number" pattern="[0-9]*" placeholder="请输入年龄">
                </div>
            </div>

            <div class="weui-cell">
                <div class="weui-cell__hd">
                    <label class="weui-label">学历</label>
                </div>
                <div class="weui-cell__bd">
                    <input class="weui-input input_education" type="text" placeholder="请输入学历">
                </div>
            </div>
            
            <div class="weui-cell">
                    <div class="weui-cell__hd">
                        <label class="weui-label">学位</label>
                    </div>
                    <div class="weui-cell__bd">
                        <input class="weui-input input_education2" type="text" placeholder="请输入学位">
                    </div>
                </div>
            <div class="weui-cell">
                <div class="weui-cell__hd">
                    <label class="weui-label">授予院校</label>
                </div>
                <div class="weui-cell__bd">
                    <input class="weui-input input_school" type="text" placeholder="请输入授予院校">
                </div>
            </div>
            <div class="weui-cell weui-cell_switch">
                <div class="weui-cell__bd">博士后经历</div>
                <div class="weui-cell__ft">
                    <label for="switchCP" class="weui-switch-cp">
                        <input id="switchCP" class="weui-switch-cp__input" type="checkbox" checked="checked">
                        <div class="weui-switch-cp__box"></div>
                    </label>
                </div>
            </div>
            <div class="weui-cell station_switch moving">
                <div class="weui-cell__hd">
                    <label class="weui-label">流动站名称</label>
                </div>
                <div class="weui-cell__bd">
                    <input class="weui-input input_moving" type="text" placeholder="请输入流动站名称">
                </div>
            </div>
        </div>

        <div class="weui-cells ">
            <a class="weui-cell weui-cell_access" href="patient-going.html">
                <div class="weui-cell__bd">
                    <p>工作情况</p>
                </div>
                <div class="weui-cell__ft">
                </div>
            </a>
        </div>
        <div class="btn_top"></div>
        <div class="item_btn">
            <a href="javascript:void(0)" class="btn_agree">确认提交</a>
            <!-- <a href="audit.html">确定提交</a> -->
        </div>
        <!-- 弹出层 -->
        <div id="full" class='weui-popup__container'>
            <div class="weui-popup__overlay"></div>
            <div class="weui-popup__modal">
                <img src="../image/clause.svg" alt="">
                <div class="clause_button">
                    <a href="Certification.html">不同意</a>
                    <a href="javascript:void(0)" class="clause_affirm" style="color: #5B86E5;">同意</a>
                </div>
            </div>
        </div>

    </div>
</body>
<script src="https://cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/jquery-weui/1.2.0/js/jquery-weui.min.js"></script>
<script src="../js/public.js"></script>
<script>
    $(function () {
        if(!localStorage.getItem('industry')){
            $("#full").popup();
        }
        let url = Public.url()
        console.log(url)
        $('.clause_affirm').on('click',function () {
            var id = localStorage.getItem("userId");
            console.log(localStorage.getItem("userId"))
            if(id){
                $.ajax({
                    url:`${url}/user/selectUser`,
                    data:{
                        id
                    },
                    type: 'POST',
                    success (res){
                        console.log(res)
                        if(res.user.name !== null){
                            localStorage.setItem('input_name',res.user.name);
                        }
                        if(res.user.sex !== null){
                            localStorage.setItem('input_sex',res.user.sex);
                        }
                        if(res.user.age !== null){
                            localStorage.setItem('input_age',res.user.age);
                        }
                        if(res.doctor.education !== null){
                            localStorage.setItem('input_education',res.doctor.education);
                        }
                        if(res.doctor.highestDegree !== null){
                            localStorage.setItem('input_education2',res.doctor.highestDegree);
                        }
                        if(res.doctor.school !== null){
                            localStorage.setItem('input_school',res.doctor.school);
                        }
                        if(res.doctor.bachelors !== null){
                            localStorage.setItem('input_moving',res.doctor.bachelors);
                        }
                        $('.input_name').val(localStorage.getItem('input_name'));
                        $('.input_sex').val(localStorage.getItem('input_sex'));
                        $('.input_age').val(localStorage.getItem('input_age'));
                        $('.input_education').val(localStorage.getItem('input_education'));
                        $('.input_education2').val(localStorage.getItem('input_education2'));
                        $('.input_school').val(localStorage.getItem('input_school'));
                        $('.input_moving').val(localStorage.getItem('input_moving'));
                    },
                    error (res){
                        console.log(res)
                    }
                })
            }
            $.closePopup()
        })
        $('.input_name').on('blur',function () {
            const input_name = $(this).val(); 
            localStorage.setItem('input_name',input_name);
        })
        $('.input_sex').on('blur',function () {
            const input_sex = $(this).val(); 
            localStorage.setItem('input_sex',input_sex);
        })
        $('.input_age').on('blur',function () {
            const input_age = $(this).val(); 
            localStorage.setItem('input_age',input_age);
        })
        $('.input_education').on('blur',function () {
            const input_education = $(this).val(); 
             localStorage.setItem('input_education',input_education);
        })
        $('.input_education2').on('blur',function () {
            const input_education2 = $(this).val(); 
            localStorage.setItem('input_education2',input_education2);
        })
        $('.input_school').on('blur',function () {
            const input_school = $(this).val(); 
            localStorage.setItem('input_school',input_school);
        })
        $('.input_moving').on('blur',function () {
            const input_moving = $(this).val(); 
            localStorage.setItem('input_moving',input_moving);
        })
        $('.input_phone').on('blur',function () {
            const input_phone = $(this).val(); 
            localStorage.setItem('input_phone',input_phone);
        })
        $('.input_pass').on('blur',function () {
            const input_pass = $(this).val(); 
            localStorage.setItem('input_pass',input_pass);
        })
        $('.input_name').val(localStorage.getItem('input_name'));
        $('.input_sex').val(localStorage.getItem('input_sex'));
        $('.input_age').val(localStorage.getItem('input_age'));
        $('.input_education').val(localStorage.getItem('input_education'));
        $('.input_education2').val(localStorage.getItem('input_education2'));
        $('.input_school').val(localStorage.getItem('input_school'));
        $('.input_moving').val(localStorage.getItem('input_moving'));

        $('.weui-switch-cp__input').on('change',function () {
            $('.moving').slideToggle(300)
        })

        $('.btn_agree').on('click',()=>{
            $.ajax({
            url: 'http://192.168.1.150:1002/user/insertDoctorUser',
            type: 'POST',
            data: {
                name: localStorage.getItem('input_name'),
                sex: localStorage.getItem('input_sex'),
                age: localStorage.getItem('input_age'),
                education: localStorage.getItem('input_education'),
                highestDegree: localStorage.getItem('input_education2'),
                school: localStorage.getItem('input_school'),
                postdoctor: '是',
                bachelors: localStorage.getItem('input_moving'),
                industry: localStorage.getItem('industry'),
                job: localStorage.getItem('job'),
                hospital: localStorage.getItem('hospital'),
                hplSection: localStorage.getItem('hplSection'),
                hplPhone: localStorage.getItem('hplPhone'),
                jobPhone: localStorage.getItem('jobPhone'),
                dtrId: localStorage.getItem('userId')
            },
            success (res){
                console.log(res)
                // localStorage.clear();
            },
            error (res){
                console.log(res)
            }
        })  
        })
    });
</script>

</html>